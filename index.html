<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>XR Letter - End Roll</title>

    <!-- A-Frame / AR.js -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="./js/aframe-ar.js?v=1.0.1"></script>
    <script src="./js/app.js?v=1.0.1"></script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />



    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      .overlay {
        position: fixed;
        z-index: 10;
        top: 10px;
        left: 10px;
        color: white;
        font-family: sans-serif;
      }
    </style>

    <script>
      // エンドロール用コンポーネント（planeを上に流してフェードアウト）
      AFRAME.registerComponent('endroll', {
        schema: {
          speed: { type: 'number', default: 0.25 },     // 上昇速度（m/s）
          startY: { type: 'number', default: -0.10 },    // 出現位置
          endY:   { type: 'number', default: 0.40 },     // 消える高さ
          fadeStartY: { type: 'number', default: 0.10 }  // フェード開始位置
        },

        init: function () {
          var data = this.data;
          var el = this.el;

          var pos = el.getAttribute('position') || {x: 0, y: 0, z: 0};
          pos.y = data.startY;
          el.setAttribute('position', pos);

          this.baseOpacity = 1.0;
        },

        tick: function (time, dt) {
          var data = this.data;
          var el = this.el;

          var deltaSec = dt / 1000;
          var pos = el.getAttribute('position');
          pos.y += data.speed * deltaSec;
          el.setAttribute('position', pos);

          var y = pos.y;

          // フェードアウト
          if (y >= data.fadeStartY) {
            var t = (y - data.fadeStartY) / (data.endY - data.fadeStartY);
            var alpha = Math.max(0, 1 - t) * this.baseOpacity;

            el.setAttribute('material', 'opacity', alpha);
            el.setAttribute('material', 'transparent', true);
          }

          // 一定高さを超えたら削除
          if (y >= data.endY) {
            if (el.parentNode) {
              el.parentNode.removeChild(el);
            }
          }
        }
      });

      // キャンバスに日本語テキストを書き込む
     function drawMessageToCanvas() {
        var canvas = document.getElementById('msgCanvas');
        if (!canvas) return;
      
        // ちょっと広め＋少し縦も大きく
        canvas.width = 1400;
        canvas.height = 300;
      
        var ctx = canvas.getContext('2d');
      
        // 透明背景
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      
        // テキストスタイル（少し小さめに）
        ctx.font = "bold 80px 'Yu Gothic', 'Noto Sans JP', sans-serif";
        ctx.fillStyle = "#ffffff";
        ctx.textAlign = "left";                 // ★ 左寄せ
        ctx.textBaseline = "middle";
      
        var text = "今までありがとうございました！";
        // 左に 80px の余白を空けて描く
        ctx.fillText(text, 80, canvas.height / 2);
    　}


      document.addEventListener('DOMContentLoaded', function () {
        drawMessageToCanvas();
      });
    </script>
  </head>

  <body>
    <div class="overlay">XR Letter Loading... (End Roll)</div>

    <a-scene
      embedded
      renderer="antialias: true; alpha: true"
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-assets>
        <!-- テキストを書き込むキャンバス -->
        <canvas id="msgCanvas"></canvas>
      </a-assets>

      <!-- Hiro マーカー -->
     <a-marker preset="hiro">
    
      <a-plane
        id="msgPlane"
        material="src: #msgCanvas; transparent: true"
        height="0.65"
        width="2"
        position="0 0 0.15"
        endroll="speed: 0.01; startY: -0.20; endY: 0.70; fadeStartY: 0.20"
      ></a-plane>
    </a-marker>
    
    

      <!-- カメラ -->
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
